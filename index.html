<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>Yuzu Survivor</title>
    <script src="https://cdn.jsdelivr.net/npm/phaser@3.60.0/dist/phaser-arcade-physics.min.js"></script>
    <style>
        body { margin: 0; display: flex; justify-content: center; align-items: center; height: 100vh; background-color: #000; overflow: hidden; }
        canvas { border: 2px solid #fff; }
    </style>
</head>
<body>
    <script>
        // --- 1. 메인 화면 씬 (StartScene) ---
        class StartScene extends Phaser.Scene {
            constructor() { super('StartScene'); }
            preload() {
                this.load.image('main_yuzu', 'main_yuzu.webp');
            }
            create() {
                // 배경 그래디언트 효과 (임시 사각형으로 구현)
                const graphics = this.add.graphics();
                graphics.fillGradientStyle(0x1a1a1a, 0x1a1a1a, 0x4a4a4a, 0x4a4a4a, 1);
                graphics.fillRect(0, 0, 800, 600);

                this.add.image(400, 200, 'main_yuzu').setScale(0.5);
                this.add.text(400, 350, '유즈 서바이버', { fontSize: '48px', fill: '#fff', fontWeight: 'bold' }).setOrigin(0.5);
                
                const startBtn = this.add.text(400, 450, '[ 게임 시작 ]', { fontSize: '32px', fill: '#ffcc00' })
                    .setOrigin(0.5)
                    .setInteractive({ useHandCursor: true })
                    .on('pointerdown', () => this.scene.start('GameScene'));
            }
        }

        // --- 2. 실제 게임 씬 (GameScene) ---
        class GameScene extends Phaser.Scene {
            constructor() { super('GameScene'); }

            preload() {
                this.load.image('main_yuzu', 'main_yuzu.webp');
                this.load.image('enemy_wildyuzu', 'enemy_wildyuzu.webp');
                this.load.image('weapon_gyul', 'weapon_gyul.webp');
                
                // 효과음 로드 (파일명은 임의로 지정, 파일이 있어야 소리가 납니다)
                this.load.audio('snd_fire', 'fire.mp3'); 
                this.load.audio('snd_hit', 'hit.mp3');
            }

            create() {
                // 4. 배경 그래디언트 설정
                const bg = this.add.graphics();
                bg.fillGradientStyle(0x000033, 0x000033, 0x660066, 0x660066, 1);
                bg.fillRect(0, 0, 800, 600);

                // 1. 스프라이트 크기 조절 (setScale 사용)
                this.player = this.physics.add.sprite(400, 300, 'main_yuzu');
                this.player.setScale(0.3); // 주인공 크기 조절
                this.player.setCollideWorldBounds(true);

                this.enemies = this.physics.add.group();
                this.weapons = this.physics.add.group({ defaultKey: 'weapon_gyul', maxSize: 30 });
                
                this.weaponLevel = 1;
                this.lastFired = 0;
                this.cursors = this.input.keyboard.createCursorKeys();

                this.time.addEvent({ delay: 1000, callback: this.spawnEnemy, callbackScope: this, loop: true });
                this.physics.add.overlap(this.weapons, this.enemies, this.hitEnemy, null, this);
            }

            update(time) {
                this.player.setVelocity(0);
                if (this.cursors.left.isDown) this.player.setVelocityX(-200);
                else if (this.cursors.right.isDown) this.player.setVelocityX(200);
                if (this.cursors.up.isDown) this.player.setVelocityY(-200);
                else if (this.cursors.down.isDown) this.player.setVelocityY(200);

                if (time > this.lastFired) this.fireGyul(time);

                this.enemies.getChildren().forEach(enemy => {
                    this.physics.moveToObject(enemy, this.player, 100);
                });
            }

            fireGyul(time) {
                const shootCount = this.weaponLevel;
                for (let i = 0; i < shootCount; i++) {
                    let gyul = this.weapons.get(this.player.x, this.player.y);
                    if (gyul) {
                        gyul.setActive(true).setVisible(true);
                        gyul.setScale(0.1); // 1. 귤 크기 아주 작게 조절
                        
                        const angle = (i * 0.3) - (shootCount * 0.15);
                        this.physics.moveTo(gyul, this.player.x + 100, this.player.y + (angle * 200), 400);
                        
                        // 3. 발사 효과음
                        if (this.sound.get('snd_fire')) this.sound.play('snd_fire', { volume: 0.5 });

                        this.time.delayedCall(1500, () => { gyul.setActive(false).setVisible(false); });
                    }
                }
                this.lastFired = time + 800;
            }

            spawnEnemy() {
                const x = Phaser.Math.Between(0, 1) ? 0 : 800;
                const y = Phaser.Math.Between(0, 600);
                const enemy = this.enemies.create(x, y, 'enemy_wildyuzu');
                enemy.setScale(0.2); // 1. 괴즈 크기 조절
            }

            hitEnemy(weapon, enemy) {
                weapon.setActive(false).setVisible(false);
                enemy.destroy();
                // 3. 처치 효과음
                if (this.sound.get('snd_hit')) this.sound.play('snd_hit', { volume: 0.5 });
            }
        }

        // 게임 설정에 씬 등록
        const config = {
            type: Phaser.AUTO,
            width: 800,
            height: 600,
            physics: { default: 'arcade', arcade: { debug: false } },
            scene: [StartScene, GameScene] // 메인 화면부터 시작
        };

        const game = new Phaser.Game(config);
    </script>
</body>
</html>
